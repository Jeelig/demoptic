<template>
	<div class="page" data-name="opticien" ng-controller="OpticienController" ng-init="init()">
		<div class="navbar">
			<div class="navbar-bg"></div>
			<div class="navbar-inner sliding">
				<div class="left">
					<a href="#" class="link back">
						<i class="icon icon-back"></i>
						<span class="if-not-md">Back</span>
					</a>
				</div>
				<div class="title">Mon opticien</div>
				<div class="right">
					<a href="#" class="link" @click="${like}" id="idontlike">
						<div class="f7-icons">heart</div>
					</a>
					<a href="#" class="link" @click="${unlike}" id="ilike" style="display: none;">
						<div class="f7-icons">heart_fill</div>
					</a>
				</div>
			</div>
		</div>
		<div class="page-content" style="background-color: #F2F2F2;">

			<div class="opticien_blue_area" style="height:130px;">
				<div class="row no-gap" style="padding-top:20px">
					<div class="col-40 imgr"><img src=${opticien.image}/></div>
					<div class="col-60 contr">
						<div class="optic_title">${opticien.name}</div>
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td rowspan="2"><div><img src="assets/img/optic/horaires.png"/></div></td>
								<td>${opticien.ouverture}</td>
							</tr>
							<tr>
								<td>${opticien.horaires}</td>
							</tr>
						</table>
						<div class="opt_adr">${opticien.adresse}</div>
						<div class="opt_web">${opticien.website}</div>
					</div>
				</div>
			</div>

			<div class="above_list_optk on_opticien">

				<div class="list media-list inset" style="margin-top: 20px; text-align: left;">
					
					<div class="optic_title">${opticien.name}</div>
					<div class="optic_expertize">${opticien.description}</div>
					<div class="f7-icons star" ng-class="{'gray': optic.stars<1}">star_fill</div>
					<div class="f7-icons star" ng-class="{'gray': optic.stars<2}">star_fill</div>
					<div class="f7-icons star" ng-class="{'gray': optic.stars<3}">star_fill</div>
					<div class="f7-icons star" ng-class="{'gray': optic.stars<4}">star_fill</div>
					<div class="f7-icons star" ng-class="{'gray': optic.stars<5}">star_fill</div>

					<img src=${opticien.encart1} style="width:100%; margin-top:20px;"/>

					<div class="carousel carousel-1">
						<div>
							<ul>
								<li><div><img src="assets/img/optic/examendevue.png" style="margin-top: 17px;"/></div></li>
								<li><div><img src="assets/img/optic/centreville.png" style="margin-top: 4px;"/></div></li>
								<li><div><img src="assets/img/optic/uvprotection.png" style="margin-top: 22px;"/></div></li>
								<li><div><img src="assets/img/optic/lunettesdesport.png" style="margin-top: 17px;"/></div></li>
								<li><div><img src="assets/img/optic/centrecommercial.png" style="margin-top: 10px;"/></div></li>
								<li><div><img src="assets/img/optic/acceshandicape.png" style="margin-top: 6px;"/></div></li>
							</ul>
						</div>
					</div>
					

					<div class="optic_tit_cat">Montures</div>
					<div class="nSubText">Selectionnez un materiau et découvrez tous ses avantages *</div>

					<div class="carousel carousel-2">
						<div>
							<ul>
								<li class="cr_tita">Titane</li>
								<li class="cr_acet">Acetate</li>
								<li class="cr_plas">Plastique</li>
								<li class="cr_meta">Metallique</li>
								<li class="cr_bois">Bois</li>
								<li class="cr_carb">Carbone</li>
								<li class="cr_corn">Corne</li>
								<li class="cr_recy">Recyclé</li>
							</ul>
						</div>
					</div>
					
					<div class="opt_info_resistance">
						<div class="row no-gap">
							<div class="col-15" style="text-align:center; padding-top: 4px;"><img src="assets/img/face/ampoule conseils.png" style="width:35px"/></div>
							<div class="col-85" style="font-size:12px;">
								Resistantes et ultra légères , les montures en titane sont élégantes et ne vous laisseront pas de marque sur le nez.
							</div>
						</div>
					</div>

				</div>

			</div>

			
			<div class="opticien_gray_area" style="height:130px;">

				<div style="padding: 15px;">
					<div class="optic_tit_cat">GARANTIES & SAV*</div>
					<ul>
						<li><img src="assets/img/optic/mutuelle.jpg"/></li>
						<li><img src="assets/img/optic/paiementcarte.png"/></li>
						<li><img src="assets/img/optic/paiementcheque.png"/></li>
					</ul>
				</div>
			</div>
			
		</div>
	</div>
</template>

<script>
	export default function (props, { $f7, $on, $update }) {
		// Component Data
		//var self = this;
		let name = "Jimmy";
		let age = 25;
		let likes = ["Tennis", "Chess", "Football"];
		var id = props.id;
		var opticien = {name:"toto"};

		const like = () => {
			supe.from('favoris')
			.insert({ 
				"user": global.user.id, 
				"opticien": id
			})
			.then(function(e) {
				meLike(true);
			})
			.catch(function(e) { console.warn(e) })
		};
		const unlike = () => {
			supe.from('favoris')
			.delete()
			.eq('user', global.user.id)
			.eq('opticien', id)
			.then(function(e) {
				meLike(false);
			})
			.catch(function(e) { console.warn(e) })
		};

		// Component Methods
		const openAlert = () => {
			$f7.dialog.alert("Hello World");
		};
		
		const addValue = () => {
			debugger;
			$update();
		};

		const liked = () => {
			supe.from('favoris')
			.select("id")
			.eq('opticien', id)
			.then((response) => {
				console.log(response);
				if (response.data.length > 0) meLike(true);
				else meLike(false);
			})
			.catch((err) => {
				console.warn(err);
				meLike(false);
			});
		};

		const meLike = function(status) {
			if (status) {
				document.getElementById("ilike").style.display = "block";
				document.getElementById("idontlike").style.display = "none";
			}
			else {
				document.getElementById("ilike").style.display = "none";
				document.getElementById("idontlike").style.display = "block";
			}
		};

		// Page Events
		$on("pageMounted", (e, page) => {
			console.log("pageMounted", page);
		});
		$on("pageInit", (e, page) => {
			var self = this;
			console.log("pageInit", page);
			supe.from('Opticien')
			.select(`id, name, adresse, email, telephone, image, website, stars, Ville, CodePostal, description, encart1, encart2, horaires, ouverture)`)
			.eq('id', id)
			.then((response) => {
				console.log(response);
				opticien = response.data[0];
				if (opticien.image == null ||
					opticien.image == "") {
					opticien.image = "assets/img/no.png"
				}
				$update();
				liked();
				MyApp.fw7.app.emit("opticien", opticien);
			}).catch((error)=> {
				console.warn(error);
			});
		});
		$on("pageBeforeIn", (e, page) => {
			console.log("pageBeforeIn", page);
		});
		$on("pageAfterIn", (e, page) => {
			console.log("pageAfterIn", page);
		});
		$on("pageBeforeOut", (e, page) => {
			console.log("pageBeforeOut", page);
		});
		$on("pageAfterOut", (e, page) => {
			console.log("pageAfterOut", page);
		});
		$on("pageBeforeRemove", (e, page) => {
			console.log("pageBeforeRemove", page);
		});


		// Return render function
		return $render;
	}
</script>